

--todos os valores estao em reais
CREATE TYPE TIPO_ATIVO AS ENUM('ação','ETF','FII','opcão','debentures');


CREATE TYPE STATUS_ATIVO AS ENUM('ativo','inativo');

CREATE TYPE RISCO_ATIVO AS ENUM('moderado','conservador','agressivo');

CREATE TABLE ATIVO (
    COD_ATIVO VARCHAR(12) PRIMARY KEY,
    NOME VARCHAR(50) NOT NULL,
    TIPO  TIPO_ATIVO NOT NULL,
    STATUS  STATUS_ATIVO DEFAULT 'ativo',
    RISCO  RISCO_ATIVO,
    DAT_REGISTRO TIMESTAMP DEFAULT NULL,
    DAT_ULTIMA_TRANSACAO TIMESTAMP DEFAULT NULL,
    PRECO_ATUAL DECIMAL(6, 2) DEFAULT NULL,   
    VOLUME_NEGOCIADO_MES DECIMAL(13, 2) DEFAULT NULL 
    
    
    
);

CREATE TYPE TIPO_INVESTIDOR AS ENUM('Física','Jurídica');

CREATE TABLE INVESTIDOR (
    COD_INVESTIDOR VARCHAR(20) PRIMARY KEY UNIQUE,
    NOME VARCHAR(50) NOT NULL,
    TIPO TIPO_INVESTIDOR NOT NULL,
    SALDO DECIMAL (10,2) NOT NULL,
    PERFIL VARCHAR(15),
    DAT_CADASTRO DATE NOT NULL
);

CREATE TABLE POSICAO (
    COD_POSICAO INT PRIMARY KEY,
    COD_INVESTIDOR VARCHAR(20) NOT NULL,
    COD_ATIVO VARCHAR(10) NOT NULL,
    VALOR_ATUAL DECIMAL(10, 2) NOT NULL, --quantidade x preco atual
    QUANTIDADE INT NOT NULL,
    PRECO_MEDIO DECIMAL(10, 2) NOT NULL,
    DAT_ULTIMA_ATUALIZACAO TIMESTAMP NOT NULL,--data da ultima mudanca da posicao, isto é, operação de compra/venda (o valor atual autaliza de acordo com o preço atual, mas isso nao interfere a data)
    CONSTRAINT FK_INVESTIDOR FOREIGN KEY (COD_INVESTIDOR)
        REFERENCES INVESTIDOR(COD_INVESTIDOR)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    CONSTRAINT FK_ATIVO FOREIGN KEY (COD_ATIVO)
        REFERENCES ATIVO(COD_ATIVO)
        ON DELETE RESTRICT
        ON UPDATE CASCADE
);

CREATE TYPE TIPO_ORDEM AS ENUM('compra','venda');
CREATE TYPE MODO_ORDEM AS ENUM('limitada','mercado');
CREATE TYPE EXECUCAO_ORDEM AS ENUM('parcial','total');
CREATE TYPE STATUS_ORDEM AS ENUM('cancelada','pendente','realizada');

CREATE TABLE ORDEM (
    COD_ORDEM INT PRIMARY KEY,
    COD_INVESTIDOR VARCHAR(20) NOT NULL,
    COD_ATIVO VARCHAR(12) NOT NULL,
    TIPO TIPO_ORDEM NOT NULL,
    STATUS STATUS_ORDEM DEFAULT 'pendente',
    QUANTIDADE INT NOT NULL,
     MODO MODO_ORDEM NOT NULL,
    EXECUCAO EXECUCAO_ORDEM NOT NULL,
    DAT_CRIACAO TIMESTAMP NOT NULL,
    CONSTRAINT FK_INVESTIDOR FOREIGN KEY (COD_INVESTIDOR)
        REFERENCES INVESTIDOR(COD_INVESTIDOR)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    CONSTRAINT FK_ATIVO FOREIGN KEY (COD_ATIVO)
        REFERENCES ATIVO(COD_ATIVO)
        ON DELETE RESTRICT
        ON UPDATE CASCADE
);
CREATE TABLE ORDEM_LIMITADA (
    COD_ORDEM INT PRIMARY KEY,
    PRECO_LIM DECIMAL(6, 2) DEFAULT NULL, 
    CONSTRAINT FK_ORDEM FOREIGN KEY (COD_ORDEM)
    REFERENCES ORDEM (COD_ORDEM)
);

CREATE TABLE TRANSACAO (
    COD_TRANSACAO INT PRIMARY KEY,
    COD_COMPRADOR VARCHAR(20) NOT NULL,
    COD_VENDEDOR VARCHAR(20) NOT NULL,
    COD_ATIVO VARCHAR(12) NOT NULL,
    QUANTIDADE INT NOT NULL,
    PRECO_ATIVO  DECIMAL(6, 2) NOT NULL,
    DAT_REGISTRO TIMESTAMP NOT NULL,
  CONSTRAINT FK_ATIVO FOREIGN KEY (COD_ATIVO)
      REFERENCES ATIVO(COD_ATIVO)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    CONSTRAINT FK_COMPRADOR FOREIGN KEY (COD_COMPRADOR)
        REFERENCES INVESTIDOR(COD_INVESTIDOR)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
  CONSTRAINT FK_VENDEDOR FOREIGN KEY (COD_VENDEDOR)
        REFERENCES INVESTIDOR(COD_INVESTIDOR)
        ON DELETE RESTRICT
        ON UPDATE CASCADE
);

CREATE TABLE CUSTO (
    COD_CUSTOS INT PRIMARY KEY,
    COD_TRANSACAO INT NOT NULL,
    COD_INVESTIDOR VARCHAR (20) NOT NULL,
    -- aqui, taxa de registro e de liquidacao serao o valor final em reais, e nao porcentagem, por ser mais informativo:
    TAXA_REGISTRO DECIMAL(10, 2) NOT NULL,  
    TAXA_LIQUIDACAO DECIMAL(10, 2) NOT NULL,
    IR DECIMAL(10, 2),
    CUSTO_TOTAL DECIMAL(10, 2) NOT NULL,
    CONSTRAINT FK_TRANSACAO FOREIGN KEY (COD_TRANSACAO)
        REFERENCES TRANSACAO(COD_TRANSACAO)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    CONSTRAINT FK_INVESTIDOR FOREIGN KEY (COD_INVESTIDOR)
        REFERENCES INVESTIDOR(COD_INVESTIDOR)
        ON DELETE RESTRICT
        ON UPDATE CASCADE
);
